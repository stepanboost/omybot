from aiogram import Router, F
from aiogram.types import Message
from aiogram.filters import Command
from loguru import logger

router = Router()


@router.message(Command("start"))
async def cmd_start(message: Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    user_id = message.from_user.id
    username = message.from_user.username
    first_name = message.from_user.first_name
    
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} –∑–∞–ø—É—Å—Ç–∏–ª –±–æ—Ç–∞")
    
    welcome_text = f"""
ü§ñ –ü—Ä–∏–≤–µ—Ç, {first_name}!

–Ø - **–£–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —É—á—ë–±–µ** - –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç —Ç–µ–±–µ —Ä–µ—à–∏—Ç—å –∑–∞–¥–∞—á–∏ –ø–æ —à–∫–æ–ª—å–Ω—ã–º –ø—Ä–µ–¥–º–µ—Ç–∞–º.

üìö **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã:**
‚Ä¢ –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (–∞–ª–≥–µ–±—Ä–∞, –≥–µ–æ–º–µ—Ç—Ä–∏—è)
‚Ä¢ –§–∏–∑–∏–∫–∞
‚Ä¢ –•–∏–º–∏—è
‚Ä¢ –†—É—Å—Å–∫–∏–π —è–∑—ã–∫
‚Ä¢ –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞
‚Ä¢ –ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫
‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞
‚Ä¢ –ò—Å—Ç–æ—Ä–∏—è
‚Ä¢ –ì–µ–æ–≥—Ä–∞—Ñ–∏—è
‚Ä¢ –ë–∏–æ–ª–æ–≥–∏—è

üí° **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
1. –û—Ç–ø—Ä–∞–≤—å –º–Ω–µ —É—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏ —Ç–µ–∫—Å—Ç–æ–º
2. –ò–ª–∏ –æ—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ —Ç–µ—Ç—Ä–∞–¥–∏ —Å –∑–∞–¥–∞—á–µ–π
3. –Ø –æ–ø—Ä–µ–¥–µ–ª—é –ø—Ä–µ–¥–º–µ—Ç –∏ –¥–∞–º –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

üìù **–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**
‚Ä¢ "–†–µ—à–∏ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ: 3x + 7 = 25"
‚Ä¢ "–§–∏–∑–∏–∫–∞: —Ç–µ–ª–æ –º–∞—Å—Å–æ–π 2 –∫–≥ –¥–≤–∏–∂–µ—Ç—Å—è —Å —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º 3 –º/—Å¬≤. –ù–∞–π–¥–∏ —Å–∏–ª—É"
‚Ä¢ "–•–∏–º–∏—è: —É—Ä–∞–≤–Ω—è–π —Ä–µ–∞–∫—Ü–∏—é Fe + O‚ÇÇ ‚Üí Fe‚ÇÇO‚ÇÉ"

‚ö° **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:** 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —á–∞—Å

–ù–∞–ø–∏—à–∏ /help –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∫–∏.
"""
    
    await message.answer(welcome_text)


@router.message(Command("help"))
async def cmd_help(message: Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
    help_text = """
üìñ **–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞**

üéØ **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
‚Ä¢ /start - –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º
‚Ä¢ /help - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞

üìù **–ö–∞–∫ –∑–∞–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞—á–∏:**

**–¢–µ–∫—Å—Ç–æ–º:**
```
–†–µ—à–∏ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ: 2x + 5 = 13
–ù–∞–π–¥–∏ –ø–ª–æ—â–∞–¥—å —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞ —Å–æ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ 3, 4, 5
–§–∏–∑–∏–∫–∞: —Ç–µ–ª–æ –º–∞—Å—Å–æ–π 2 –∫–≥ –¥–≤–∏–∂–µ—Ç—Å—è —Å —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º 3 –º/—Å¬≤
–•–∏–º–∏—è: —É—Ä–∞–≤–Ω—è–π —Ä–µ–∞–∫—Ü–∏—é H‚ÇÇ + O‚ÇÇ ‚Üí H‚ÇÇO
```

**–§–æ—Ç–æ:**
–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é —Ç–µ—Ç—Ä–∞–¥–∏ –∏–ª–∏ —É—Å–ª–æ–≤–∏—è –∏–∑ —É—á–µ–±–Ω–∏–∫–∞.

üìö **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã:**
1. **–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞** - —É—Ä–∞–≤–Ω–µ–Ω–∏—è, –≥–µ–æ–º–µ—Ç—Ä–∏—è, –∞–ª–≥–µ–±—Ä–∞
2. **–§–∏–∑–∏–∫–∞** - –º–µ—Ö–∞–Ω–∏–∫–∞, —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ, –æ–ø—Ç–∏–∫–∞
3. **–•–∏–º–∏—è** - —Ä–µ–∞–∫—Ü–∏–∏, –≤–µ—â–µ—Å—Ç–≤–∞, —Ä–∞—Å—á–µ—Ç—ã
4. **–†—É—Å—Å–∫–∏–π —è–∑—ã–∫** - –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞, –ø—É–Ω–∫—Ç—É–∞—Ü–∏—è
5. **–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞** - –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π
6. **–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫** - –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞, –ø–µ—Ä–µ–≤–æ–¥—ã
7. **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞** - –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞–ª–≥–æ—Ä–∏—Ç–º—ã
8. **–ò—Å—Ç–æ—Ä–∏—è** - –¥–∞—Ç—ã, —Å–æ–±—ã—Ç–∏—è, –ª–∏—á–Ω–æ—Å—Ç–∏
9. **–ì–µ–æ–≥—Ä–∞—Ñ–∏—è** - —Å—Ç—Ä–∞–Ω—ã, –∫–ª–∏–º–∞—Ç, —Ä–µ—Å—É—Ä—Å—ã
10. **–ë–∏–æ–ª–æ–≥–∏—è** - —Å—Ç—Ä–æ–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–æ–≤, –ø—Ä–æ—Ü–µ—Å—Å—ã

‚ö° **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
‚Ä¢ –ú–∞–∫—Å–∏–º—É–º 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —á–∞—Å
‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞: 2000 —Å–∏–º–≤–æ–ª–æ–≤
‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Ñ–æ—Ç–æ: JPG, PNG, WEBP

üîß **–ï—Å–ª–∏ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç:**
‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —É—Å–ª–æ–≤–∏—è –∑–∞–¥–∞—á–∏
‚Ä¢ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å
‚Ä¢ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
"""
    
    await message.answer(help_text)


@router.message()
async def handle_text(message: Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    text = message.text.strip()
    
    if not text:
        await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Å –∑–∞–¥–∞—á–µ–π.")
        return
    
    if len(text) > 2000:
        await message.answer("–¢–µ–∫—Å—Ç —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π. –ú–∞–∫—Å–∏–º—É–º 2000 —Å–∏–º–≤–æ–ª–æ–≤.")
        return
    
    # –ü—Ä–æ—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
    response = f"""
üìù **–ü–æ–ª—É—á–µ–Ω–∞ –∑–∞–¥–∞—á–∞:**

{text}

ü§ñ **–û—Ç–≤–µ—Ç:**
–≠—Ç–æ –¥–µ–º–æ-–≤–µ—Ä—Å–∏—è –±–æ—Ç–∞. –í –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç:
‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞
‚Ä¢ –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ
‚Ä¢ LaTeX —Ñ–æ—Ä–º—É–ª—ã
‚Ä¢ –ú–∏–Ω–∏-–∫–≤–∏–∑ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ OpenAI API –∫–ª—é—á.
"""
    
    await message.answer(response)
